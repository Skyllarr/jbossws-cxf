<?xml version="1.0" encoding="UTF-8"?>

<deployment xmlns="urn:jboss:bean-deployer:2.0">

  <!-- An abstraction of server configuration aspects. -->  
  <bean name="WSServerConfig" class="org.jboss.wsf.container.jboss50.ManagedServerConfig">
    <!--
        The WSDL, that is a required deployment artifact for an endpoint, has a <soap:address>
        element which points to the location of the endpoint. JBoss supports rewriting of that SOAP address.
      
        If the content of <soap:address> is a valid URL, JBossWS will not rewrite it unless 'modifySOAPAddress' is true.
        If the content of <soap:address> is not a valid URL, JBossWS will rewrite it using the attribute values given below.
        
        If 'webServiceHost' is not set, JBossWS uses requesters protocol host and port when rewriting the <soap:address>.
    -->
    <property name="webServiceHost">${jboss.bind.address}</property>
    <property name="modifySOAPAddress">true</property>
    
    <!-- 
      Set these properties to explicitly define the ports that will be used for rewriting the SOAP address.
      Otherwise the ports will be identified by querying the list of installed connectors. 
      If multiple connectors are found the port of the first connector is used.
      <property name="webServiceSecurePort">8443</property>
      <property name="webServicePort">8080</property>
    -->
  </bean>

  <!-- The registry for web service endpoints -->
  <bean name="WSEndpointRegistry" class="org.jboss.wsf.stack.xfire.ManagedEndpointRegistry"/>
  
  <!-- Bind Service objects in client environment context  -->
  <!-- The bean name is compiled into the server. Changeit with the next release. -->
  <!--bean name="ServiceRefHandler" class="org.jboss.ws.core.client.ServiceRefHandlerImpl"/-->
  
  <!-- Locate the single instance of the kernel -->  
  <bean name="WSKernelLocator" class="org.jboss.ws.integration.KernelLocator">
    <property name="kernel"><inject bean="jboss.kernel:service=Kernel"/></property>
  </bean>
  
  <!-- 
    ********************************************************************************************************************* 
    Web Service deployment                                                                                                
    
    There are three deployers registered with the JBoss Main Deployer. 
    The order of which is important
    
    1) EJBDeployer < WebServiceDeployerEJB
    2) WebServiceDeployerJSE < WarDeployer 
    3) WebServiceMainDeployer
    
    Each WebServiceDeployer has a number of DeployerHooks registerd with it 
    
    - WebServiceDeployerEJB
      - WSDeployerHook_JAXRPC_EJB21
      - WSDeployerHook_JAXWS_EJB3
    
    - WebServiceDeployerJSE
      - WSDeployerHook_JAXRPC_JSE
      - WSDeployerHook_JAXWS_JSE
    
    -  WebServiceMainDeployer
      - WSMainDeployerHook    
    
    Conceptually, each of these hooks implements the following pattern:
    
    DployerHook.deploy(unit) 
      if(isWebServiceDeployment)
        Deployment dep = createDeployment(unit)
        DeployerManager.deploy(dep)
 
    DeployerHook.undeploy(unit)
      Deployment dep = getDeployment(unit) 
      DeployerManager.undeploy(dep)
    
    Each deployer hook has a web service DeployerManager injected into it. 
    A web service DeployerManager maintains a list of Deployers, each of which 
    handles a single aspect of web service deployment.
    
    Finally, each Endpoint is registered with the EndpointRegistry.
    
    ********************************************************************************************************************* 
  -->
  
  <!-- 
    Each DeploymentManger maintains a list of Deployers
    Each Deployer handles a single aspect of web service deployment.
  -->
  <bean name="WSDeployerManagerJSE" class="org.jboss.wsf.spi.deployment.BasicDeployerManager">
    <property name="deployers">
      <list class="java.util.LinkedList" elementClass="org.jboss.wsf.spi.deployment.Deployer">
        <inject bean="WSUnifiedDeploymentInfoDeployer"/>
        <inject bean="WSContextRootDeployer"/>
        <inject bean="WSURLPatternDeployer"/>
        <inject bean="WSXFireServicesDeployer"/>
        <inject bean="WSModifyWebMetaDataDeployer"/>
      </list>
    </property>
  </bean>
  <bean name="WSDeployerManagerEJB" class="org.jboss.wsf.spi.deployment.BasicDeployerManager">
    <property name="deployers">
      <list class="java.util.LinkedList" elementClass="org.jboss.wsf.spi.deployment.Deployer">
        <inject bean="WSUnifiedDeploymentInfoDeployer"/>
        <inject bean="WSContextRootDeployer"/>
        <inject bean="WSURLPatternDeployer"/>
        <inject bean="WSXFireServicesDeployer"/>
        <inject bean="WSWebAppGeneratorDeployer"/>
        <inject bean="WSWebAppDeployerDeployer"/>
      </list>
    </property>
  </bean>
  <bean name="WSMainDeployerManager" class="org.jboss.wsf.spi.deployment.BasicDeployerManager">
    <property name="deployers">
      <list class="java.util.LinkedList" elementClass="org.jboss.wsf.spi.deployment.Deployer">
        <inject bean="WSEndpointNameDeployer"/>
        <inject bean="WSEndpointHandlerDeployer"/>
        <inject bean="WSEndpointRegistryDeployer"/>
        <inject bean="WSEndpointLifecycleDeployer"/>
      </list>
    </property>
  </bean>
  
  <!-- 
    The Deployers
    Each handles a single aspect of web service deployment 
  --> 
  <bean name="WSContextRootDeployer" class="org.jboss.wsf.spi.deployment.ContextRootDeployer"/>
  <bean name="WSEndpointHandlerDeployer" class="org.jboss.wsf.spi.deployment.EndpointHandlerDeployer">
    <property name="requestHandler">org.jboss.wsf.stack.xfire.RequestHandlerImpl</property>
    <property name="lifecycleHandler">org.jboss.wsf.stack.xfire.LifecycleHandlerImpl</property>
    <property name="invocationHandler">
      <map keyClass="java.lang.String" valueClass="java.lang.String">
        <entry><key>JAXWS_JSE</key><value>org.jboss.wsf.spi.invocation.InvocationHandlerJSE</value></entry>
        <entry><key>JAXWS_EJB3</key><value>org.jboss.wsf.container.jboss50.InvocationHandlerEJB3</value></entry>
      </map>
    </property>
  </bean>
  <bean name="WSEndpointLifecycleDeployer" class="org.jboss.wsf.spi.deployment.EndpointLifecycleDeployer"/>
  <bean name="WSEndpointNameDeployer" class="org.jboss.wsf.spi.deployment.EndpointNameDeployer"/>
  <bean name="WSEndpointRegistryDeployer" class="org.jboss.wsf.spi.deployment.EndpointRegistryDeployer"/>
  <bean name="WSModifyWebMetaDataDeployer" class="org.jboss.wsf.stack.xfire50.ModifyWebMetaDataDeployer">
    <property name="servletClass"><inject bean="WSWebAppDesciptorModifier" property="servletClass"/></property>
  </bean>
  <bean name="WSUnifiedDeploymentInfoDeployer" class="org.jboss.wsf.container.jboss50.UnifiedDeploymentInfoDeployer"/>
  <bean name="WSURLPatternDeployer" class="org.jboss.wsf.spi.deployment.URLPatternDeployer"/>
  <bean name="WSWebAppGeneratorDeployer" class="org.jboss.wsf.spi.deployment.WebAppGeneratorDeployer">
    <property name="securityHandlerEJB3"><inject bean="WSSecurityHandlerEJB3"/></property>
  </bean>
  <bean name="WSWebAppDeployerDeployer" class="org.jboss.wsf.container.jboss50.WebAppDeployerDeployer">
    <property name="webXMLRewriter"><inject bean="WSWebXMLRewriter"/></property>
    <property name="mainDeployer"><inject bean="MainDeployer"/></property>
  </bean>
  <bean name="WSXFireServicesDeployer" class="org.jboss.wsf.stack.xfire.XFireServicesDeployer">
    <property name="serviceFactory">org.codehaus.xfire.jaxws.JAXWSServiceFactory</property>
    <property name="invokerEJB3">org.jboss.wsf.stack.xfire.InvokerEJB3</property>
    <property name="invokerJSE">org.jboss.wsf.stack.xfire.InvokerJSE</property>
  </bean>
  
  <!-- Deployer helper beans -->  
  <bean name="WSSecurityHandlerEJB21" class="org.jboss.wsf.container.jboss50.SecurityHandlerEJB21"/>
  <bean name="WSSecurityHandlerEJB3" class="org.jboss.wsf.container.jboss50.SecurityHandlerEJB3"/>
  <bean name="WSWebAppDesciptorModifier" class="org.jboss.wsf.stack.xfire.WebAppDesciptorModifierImpl">
    <property name="servletClass">org.jboss.wsf.stack.xfire.XFireConfigurableServletExt</property>
  </bean>
  <bean name="WSWebXMLRewriter" class="org.jboss.wsf.spi.deployment.WebXMLRewriter">
    <property name="desciptorModifier"><inject bean="WSWebAppDesciptorModifier"/></property>
  </bean>
  
  <!-- 
    Register DeployerHooks with JBoss deployers 
  -->
  <bean name="WSDeployerHook_JAXRPC_JSE" class="org.jboss.wsf.container.jboss50.JAXRPCDeployerHookJSE">
    <property name="deploymentClass">org.jboss.wsf.spi.deployment.BasicDeployment</property>
    <property name="endpointClass">org.jboss.wsf.spi.deployment.BasicEndpoint</property>
    <property name="deployerManager"><inject bean="WSDeployerManagerJSE"/></property>
    <install bean="WebServiceDeployerJSE" method="addDeployerHook">
      <parameter>
        <this/>
      </parameter>
    </install>
    <uninstall bean="WebServiceDeployerJSE" method="removeDeployerHook">
      <parameter>
        <this/>
      </parameter>
    </uninstall>
    <depends>WebServiceDeployerJSE</depends>
  </bean>
  <bean name="WSDeployerHook_JAXRPC_EJB21" class="org.jboss.wsf.container.jboss50.JAXRPCDeployerHookEJB21">
    <property name="deploymentClass">org.jboss.wsf.spi.deployment.BasicDeployment</property>
    <property name="endpointClass">org.jboss.wsf.spi.deployment.BasicEndpoint</property>
    <property name="deployerManager"><inject bean="WSDeployerManagerEJB"/></property>
    <install bean="WebServiceDeployerEJB" method="addDeployerHook">
      <parameter>
        <this/>
      </parameter>
    </install>
    <uninstall bean="WebServiceDeployerEJB" method="removeDeployerHook">
      <parameter>
        <this/>
      </parameter>
    </uninstall>
    <depends>WebServiceDeployerEJB</depends>
  </bean>
  <bean name="WSDeployerHook_JAXWS_JSE" class="org.jboss.wsf.container.jboss50.JAXWSDeployerHookJSE">
    <property name="deploymentClass">org.jboss.wsf.spi.deployment.BasicDeployment</property>
    <property name="endpointClass">org.jboss.wsf.spi.deployment.BasicEndpoint</property>
    <property name="deployerManager"><inject bean="WSDeployerManagerJSE"/></property>
    <install bean="WebServiceDeployerJSE" method="addDeployerHook">
      <parameter>
        <this/>
      </parameter>
    </install>
    <uninstall bean="WebServiceDeployerJSE" method="removeDeployerHook">
      <parameter>
        <this/>
      </parameter>
    </uninstall>
    <depends>WebServiceDeployerJSE</depends>
  </bean>
  <bean name="WSDeployerHook_JAXWS_EJB3" class="org.jboss.wsf.container.jboss50.JAXWSDeployerHookEJB3">
    <property name="deploymentClass">org.jboss.wsf.spi.deployment.BasicDeployment</property>
    <property name="endpointClass">org.jboss.wsf.spi.deployment.BasicEndpoint</property>
    <property name="deployerManager"><inject bean="WSDeployerManagerEJB"/></property>
    <install bean="WebServiceDeployerEJB" method="addDeployerHook">
      <parameter>
        <this/>
      </parameter>
    </install>
    <uninstall bean="WebServiceDeployerEJB" method="removeDeployerHook">
      <parameter>
        <this/>
      </parameter>
    </uninstall>
    <depends>WebServiceDeployerEJB</depends>
  </bean>
  <bean name="WSMainDeployerHook" class="org.jboss.wsf.container.jboss50.MainDeployerHook">
    <property name="deployerManager"><inject bean="WSMainDeployerManager"/></property>
    <install bean="WebServiceMainDeployer" method="addDeployerHook">
      <parameter>
        <this/>
      </parameter>
    </install>
    <uninstall bean="WebServiceMainDeployer" method="removeDeployerHook">
      <parameter>
        <this/>
      </parameter>
    </uninstall>
    <depends>WebServiceMainDeployer</depends>
  </bean>
    
</deployment>
