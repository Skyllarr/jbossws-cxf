<?xml version="1.0" encoding="UTF-8"?>

<!-- ====================================================================== -->
<!--                                                                        -->
<!--  JBoss, the OpenSource J2EE webOS                                      -->
<!--                                                                        -->
<!--  Distributable under LGPL license.                                     -->
<!--  See terms of license at http://www.gnu.org.                           -->
<!--                                                                        -->
<!-- ====================================================================== -->

<!-- $Id$ -->

<project basedir="." name="JBossWS-CXF">
  
  <!-- Load ant.properties -->
  <available property="ant.properties.available" file="${basedir}/ant.properties"/>
  <fail message="Cannot find ant.properties. Did you copy/edit ant.properties.example?" unless="ant.properties.available"/>
  <property file="${basedir}/ant.properties"/>
  
  <!-- ================================================================== -->
  <!-- Setup                                                              -->
  <!-- ================================================================== -->

  <property name="cxf.dir" value="${basedir}"/>
  <property name="cxf.distro.dir" value="${cxf.dir}/src/main/distro"/>
  <property name="cxf.output.dir" value="${cxf.dir}/target"/>
  <property name="cxf.modules.dir" value="${cxf.dir}/modules"/>
  <property name="cxf.management.dir" value="${cxf.modules.dir}/management"/>
  <property name="cxf.client.dir" value="${cxf.modules.dir}/client"/>
  <property name="cxf.server.dir" value="${cxf.modules.dir}/server"/>
  
  <property name="deploy.artifacts.dir" value="${cxf.output.dir}/deploy-artifacts"/>
  <property name="deploy.structure.jboss42" value="${cxf.output.dir}/deploy-jboss422"/>
  <property name="deploy.structure.jboss50" value="${cxf.output.dir}/deploy-jboss500"/>
  
  <import file="${cxf.distro.dir}/build-setup.xml"/>
  <import file="${cxf.distro.dir}/build-deploy.xml"/>
  <import file="${cxf.distro.dir}/jbossws-deploy-macros.xml"/>
  
  <property name="jbossws.default.deploy.conf" value="${cxf.distro.dir}/jbossws-default-deploy.conf"/>
  
  <!-- ================================================================== -->
  <!-- Initialization                                                     -->
  <!-- ================================================================== -->
  
  <target name="init" depends="prepare">
    <xmlproperty file="${cxf.dir}/pom.xml"/>
    <property name="version.id" value="${project.version}"/>      
    <echo message="version.id=${version.id}"/>
  </target>
  
  <!-- ================================================================== -->
  <!-- Distribution                                                       -->
  <!-- ================================================================== -->
  
  <target name="build-bin-dist" depends="prepare" description="Build the binary distribution">
    
    <echo message="*************************************"/>
    <echo message="* mvn -P bindist assembly:directory *"/>
    <echo message="*************************************"/>
    
    <delete dir="${cxf.output.dir}/jbossws-cxf-dist"/>
    <exec dir="${basedir}" executable="mvn" failonerror="true">
      <arg value="-P bindist"/>
      <arg value="assembly:directory"/>
    </exec>
  </target>
  
  <!-- ================================================================== -->
  <!-- Miscellaneous                                                       -->
  <!-- ================================================================== -->
  
  <target name="prepare-deploy" depends="prepare">
    
    <echo message="*************************************************"/>
    <echo message="* mvn -Denv=${jbossws.integration.target} package assembly:directory *"/>
    <echo message="*************************************************"/>
    
    <delete dir="${deploy.artifacts.dir}"/>
    <exec dir="${basedir}" executable="mvn" failonerror="true">
      <arg value="-Denv=${jbossws.integration.target}"/>
      <arg value="package"/>
      <arg value="assembly:directory"/>
    </exec>
  </target>
  
  <target name="clean" depends="prepare" description="Cleans up most generated files.">
    
    <echo message="*************************************"/>
    <echo message="* mvn clean                         *"/>
    <echo message="*************************************"/>
    
    <exec dir="${basedir}" executable="mvn" failonerror="true">
      <arg value="clean"/>
    </exec>
  </target>
  
</project>
