<?xml version="1.0" encoding="UTF-8"?>

<!-- ====================================================================== -->
<!--                                                                        -->
<!--  JBoss, the OpenSource J2EE webOS                                      -->
<!--                                                                        -->
<!--  Distributable under LGPL license.                                     -->
<!--  See terms of license at http://www.gnu.org.                           -->
<!--                                                                        -->
<!-- ====================================================================== -->

<!-- $Id$ -->

<project>

	<!-- ================================================================== -->
	<!-- Binary distribution                                                -->
	<!-- ================================================================== -->

  <target name="build-bin-dist" depends="jars,javadoc,prepare-deploy" description="Build the binary distribution">
    
    <property name="bindist.dir" value="${cxf.output.dir}/jbossws-cxf-dist"/>
    <property name="bindist.build.dir" value="${bindist.dir}/build"/>
    <property name="bindist.deploy.dir" value="${bindist.dir}/deploy"/>
    <property name="bindist.docs.dir" value="${bindist.dir}/docs"/>
    <property name="bindist.tests.dir" value="${bindist.dir}/tests"/>
    <property name="bindist.tools.dir" value="${bindist.dir}/tools"/>
    
    <delete dir="${bindist.dir}"/>
    <mkdir dir="${bindist.build.dir}"/>
    <mkdir dir="${bindist.deploy.dir}"/>
    <mkdir dir="${bindist.docs.dir}"/>
    <mkdir dir="${bindist.tests.dir}"/>
    <mkdir dir="${bindist.tools.dir}"/>
    
    <!-- root -->
    <copy tofile="${bindist.dir}/ant.properties.example" file="${cxf.distro.dir}/ant.properties.example">
      <filterset>
        <filtersfile file="${cxf.dir}/ant.properties"/>
      </filterset>
    </copy>
    <copy tofile="${bindist.dir}/version.properties" file="${cxf.dir}/version.properties"/>
    <copy tofile="${bindist.dir}/build.xml" file="${cxf.distro.dir}/bin-dist-build.xml"/>
    
    <!-- build -->
    <copy todir="${bindist.build.dir}">
      <fileset dir="${cxf.dir}/ant-import">
        <include name="build-deploy.xml"/>
        <include name="jbossws-deploy-macros.xml"/>
        <include name="jbossws-default-deploy.conf"/>
      </fileset>
    </copy>
    
    <!-- deploy -->
    <copy todir="${bindist.deploy.dir}">
      <fileset dir="${deploy.artifacts.dir}"/>
    </copy>
    
    <!-- docs -->
    <copy todir="${bindist.docs.dir}">
      <fileset dir="${cxf.output.dir}">
        <include name="apidocs/**"/>
      </fileset>
    </copy>
    <copy todir="${bindist.docs.dir}" filtering="yes">
      <fileset dir="${cxf.distro.dir}">
        <include name="Install.txt"/>
        <include name="ReleaseNotes.txt"/>
      </fileset>
      <filterset>
        <filtersfile file="${cxf.dir}/version.properties"/>
      </filterset>
    </copy>
    
    <copy todir="${bindist.docs.dir}">
      <fileset dir="${cxf.etc.dir}">
        <include name="JBossORG-EULA.txt"/>
      </fileset>
    </copy>
    
    <!-- tests -->
    <copy todir="${bindist.tests.dir}" overwrite="true">
      <fileset dir="${cxf.dir}/src/test-framework">
        <include name="ant-import/build-testsuite.xml"/>
        <include name="ant-import/build-samples-jaxws.xml"/>
        <include name="etc/**"/>
        <include name="java/**/jaxws/samples/**"/>
        <include name="java/**/jaxws/smoke/**"/>
        <include name="resources/jaxws/samples/**"/>
        <include name="resources/jaxws/smoke/**"/>
      </fileset>
      <fileset dir="${cxf.dir}/src/test">
        <include name="resources/test-excludes-*.txt"/>
        <include name="etc/log4j.xml"/>
      </fileset>
    </copy>
    
    <!-- build tools -->
    <copy todir="${bindist.tools.dir}" overwrite="true">
      <fileset dir="${cxf.dir}/tools"/>
    </copy>
    <copy todir="${bindist.dir}" overwrite="true">
      <fileset dir="${cxf.dir}">
        <include name="build.bat"/>
        <include name="build.sh"/>
      </fileset>
    </copy>
    <chmod file="${bindist.dir}/build.sh" perm="+x"/>
    
    <zip destfile="${cxf.output.dir}/jbossws-${version.id}.zip">
      <fileset dir="${cxf.output.dir}" includes="jbossws-cxf-dist/**"/>
    </zip>
  </target>

</project>
